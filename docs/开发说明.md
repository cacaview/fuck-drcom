# å¼€å‘è¯´æ˜

æœ¬æ–‡æ¡£é¢å‘æƒ³è¦ä¿®æ”¹ã€æ‰©å±•æˆ–æ·±å…¥ç†è§£æœ¬é¡¹ç›®çš„å¼€å‘è€…ã€‚

## ğŸ“ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Dr.COM æ ¡å›­ç½‘                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†•
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                     â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚  æœåŠ¡ç«¯  â”‚â†â”€â”€â”€â”€â”€å†…ç½‘VPNé€šé“â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  å®¢æˆ·ç«¯  â”‚
   â”‚ Server  â”‚                          â”‚ Client  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                     â”‚
        â”‚                                     â”‚
   [äº’è”ç½‘è®¿é—®]                          [é€šè¿‡æœåŠ¡ç«¯]
                                          [è®¿é—®äº’è”ç½‘]
```

### å·¥ä½œæµç¨‹

```
æœåŠ¡ç«¯æµç¨‹ï¼š
1. ç™»å½•Dr.COM (è·å¾—äº’è”ç½‘è®¿é—®)
2. å¯åŠ¨VPNç›‘å¬æœåŠ¡
3. ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥
4. å®¢æˆ·ç«¯è¿æ¥åè¢«è¸¢ä¸‹çº¿(ä½†ä¿ç•™å†…ç½‘è®¿é—®)
5. æ”¶åˆ°å®¢æˆ·ç«¯IPæŠ¥å‘Š
6. é‡æ–°ç™»å½•Dr.COM (æŠ¢å›äº’è”ç½‘è®¿é—®)
7. ä¸ºå®¢æˆ·ç«¯æä¾›VPNè½¬å‘æœåŠ¡

å®¢æˆ·ç«¯æµç¨‹ï¼š
1. ç™»å½•Dr.COM (è¸¢æ‰æœåŠ¡ç«¯)
2. å°è¯•è¿æ¥æœåŠ¡ç«¯å†…ç½‘
3. è¿æ¥æˆåŠŸåæŠ¥å‘Šè‡ªå·±çš„IP
4. ç­‰å¾…æœåŠ¡ç«¯é‡æ–°ç™»å½•
5. æœåŠ¡ç«¯ç™»å½•æˆåŠŸåè¢«è¸¢ä¸‹çº¿(ä½†ä¿ç•™å†…ç½‘è®¿é—®)
6. é€šè¿‡å†…ç½‘VPNè¿æ¥ä½¿ç”¨æœåŠ¡ç«¯çš„ç½‘ç»œ
```

## ğŸ—ï¸ æ¨¡å—è¯´æ˜

### 1. config.py - é…ç½®ç®¡ç†

**ä½œç”¨**ï¼šé›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®å‚æ•°

**ä¸»è¦é…ç½®é¡¹**ï¼š
- `DRCOM_CONFIG`: Dr.COMè®¤è¯æœåŠ¡å™¨é…ç½®
- `RETRY_CONFIG`: ç™»å½•é‡è¯•ç­–ç•¥
- `VPN_CONFIG`: VPNæœåŠ¡å‚æ•°
- `LOG_CONFIG`: æ—¥å¿—é…ç½®

**æ‰©å±•å»ºè®®**ï¼š
- å¯ä»¥æ”¹ä¸ºä»é…ç½®æ–‡ä»¶ï¼ˆå¦‚JSON/YAMLï¼‰è¯»å–
- æ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–é…ç½®
- æ·»åŠ é…ç½®éªŒè¯åŠŸèƒ½

### 2. logger.py - æ—¥å¿—ç³»ç»Ÿ

**ä½œç”¨**ï¼šæä¾›ç»Ÿä¸€çš„æ—¥å¿—è®°å½•åŠŸèƒ½

**ç‰¹æ€§**ï¼š
- åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œæ–‡ä»¶
- è‡ªåŠ¨æ—¥å¿—è½®è½¬ï¼ˆæŒ‰å¤§å°å’Œæ—¶é—´ï¼‰
- æ”¯æŒä¸åŒçº§åˆ«çš„æ—¥å¿—

**æ‰©å±•å»ºè®®**ï¼š
- æ·»åŠ æ—¥å¿—é¢œè‰²ï¼ˆä½¿ç”¨colorlogï¼‰
- æ”¯æŒè¿œç¨‹æ—¥å¿—ï¼ˆå¦‚Syslogï¼‰
- æ·»åŠ æ—¥å¿—åˆ†æå·¥å…·

### 3. drcom_login.py - Dr.COMç™»å½•æ¨¡å—

**ä½œç”¨**ï¼šæ¨¡æ‹Ÿç½‘é¡µç™»å½•Dr.COMç³»ç»Ÿ

**æ ¸å¿ƒæ–¹æ³•**ï¼š

```python
class DrcomLogin:
    def get_local_ip(self):
        """è·å–æœ¬æœºå†…ç½‘IP"""
        
    def check_network_status(self):
        """æ£€æŸ¥å½“å‰ç½‘ç»œçŠ¶æ€ï¼ˆåœ¨çº¿/ç¦»çº¿ï¼‰"""
        
    def test_internet_connection(self):
        """æµ‹è¯•æ˜¯å¦å¯ä»¥è®¿é—®äº’è”ç½‘"""
        
    def login(self):
        """æ‰§è¡Œç™»å½•æ“ä½œ"""
        
    def login_with_retry(self):
        """å¸¦é‡è¯•æœºåˆ¶çš„ç™»å½•"""
        
    def logout(self):
        """æ³¨é”€ç™»å½•"""
```

**è®¤è¯æµç¨‹**ï¼š

1. æ„é€ ç™»å½•è¯·æ±‚
2. æ¨¡æ‹Ÿæµè§ˆå™¨å‘é€HTTPè¯·æ±‚
3. è§£æå“åº”åˆ¤æ–­æ˜¯å¦æˆåŠŸ
4. é€šè¿‡pingæµ‹è¯•éªŒè¯ç½‘ç»œ

**æ‰©å±•å»ºè®®**ï¼š
- æ”¯æŒæ›´å¤šè®¤è¯æ–¹å¼ï¼ˆå¦‚Portalã€RADIUSï¼‰
- æ·»åŠ éªŒè¯ç è¯†åˆ«ï¼ˆOCRï¼‰
- æ”¯æŒå¤šè´¦å·è½®æ¢
- æ·»åŠ è‡ªåŠ¨ä¿æŒåœ¨çº¿åŠŸèƒ½

### 4. vpn_server.py - VPNæœåŠ¡ç«¯

**ä½œç”¨**ï¼šæä¾›ç½‘ç»œå…±äº«æœåŠ¡

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

```python
class VPNServer:
    def start(self):
        """å¯åŠ¨æœåŠ¡å™¨"""
        # 1. ç™»å½•ç½‘ç»œ
        # 2. å¯åŠ¨ç›‘å¬
        # 3. æ¥å—å®¢æˆ·ç«¯è¿æ¥
        
    def _accept_clients(self):
        """æ¥å—å®¢æˆ·ç«¯è¿æ¥"""
        
    def _handle_client(self, client_socket, client_address):
        """å¤„ç†å•ä¸ªå®¢æˆ·ç«¯"""
        # 1. æ¡æ‰‹
        # 2. ç­‰å¾…IPæŠ¥å‘Š
        # 3. é‡æ–°ç™»å½•
        # 4. æä¾›VPNæœåŠ¡
        
    def _provide_vpn_service(self, client_socket, client_id):
        """æä¾›VPNè½¬å‘æœåŠ¡"""
        
    def _heartbeat_monitor(self):
        """å¿ƒè·³ç›‘æ§"""
```

**é€šä¿¡åè®®**ï¼š

```
å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯:
  HELLO:<client_ip>        # æ¡æ‰‹
  REPORT_IP:<client_ip>    # æŠ¥å‘ŠIP
  HEARTBEAT                # å¿ƒè·³
  <data>                   # æ•°æ®ä¼ è¾“

æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯:
  OK                       # æ¡æ‰‹ç¡®è®¤
  LOGIN_SUCCESS            # ç™»å½•æˆåŠŸ
  LOGIN_FAILED             # ç™»å½•å¤±è´¥
  HEARTBEAT_ACK            # å¿ƒè·³å“åº”
  <data>                   # æ•°æ®ä¼ è¾“
```

**æ‰©å±•å»ºè®®**ï¼š
- å®ç°å®Œæ•´çš„SOCKS5ä»£ç†
- æ·»åŠ æµé‡ç»Ÿè®¡å’Œé™é€Ÿ
- æ”¯æŒå¤šå®¢æˆ·ç«¯å¹¶å‘
- æ·»åŠ è®¤è¯å’ŒåŠ å¯†

### 5. vpn_client.py - VPNå®¢æˆ·ç«¯ï¼ˆå‘½ä»¤è¡Œï¼‰

**ä½œç”¨**ï¼šè¿æ¥åˆ°æœåŠ¡å™¨å¹¶ä½¿ç”¨å…±äº«ç½‘ç»œ

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

```python
class VPNClient:
    def start(self):
        """å¯åŠ¨å®¢æˆ·ç«¯"""
        # 1. ç™»å½•ç½‘ç»œ
        # 2. è¿æ¥æœåŠ¡å™¨
        # 3. æŠ¥å‘ŠIP
        # 4. ç­‰å¾…æœåŠ¡å™¨ç™»å½•
        # 5. å»ºç«‹VPN
        
    def _connect_to_server(self):
        """è¿æ¥åˆ°æœåŠ¡å™¨"""
        
    def _heartbeat_loop(self):
        """å¿ƒè·³å¾ªç¯"""
        
    def _maintain_connection(self):
        """ç»´æŒè¿æ¥"""
```

**æ‰©å±•å»ºè®®**ï¼š
- æ·»åŠ è‡ªåŠ¨é‡è¿åŠŸèƒ½
- æ”¯æŒå¤šæœåŠ¡å™¨åˆ‡æ¢
- æ·»åŠ ç½‘é€Ÿæµ‹è¯•
- æ”¯æŒæ–­ç‚¹ç»­ä¼ 

### 6. vpn_client_gui.py - VPNå®¢æˆ·ç«¯ï¼ˆGUIï¼‰

**ä½œç”¨**ï¼šæä¾›å›¾å½¢ç•Œé¢çš„å®¢æˆ·ç«¯

**æŠ€æœ¯æ ˆ**ï¼šFlet (åŸºäºFlutter)

**ç‰¹æ€§**ï¼š
- è·¨å¹³å°ï¼ˆWindows/Linux/macOS/Android/iOS/Webï¼‰
- ç°ä»£åŒ–UI
- å®æ—¶æ—¥å¿—æ˜¾ç¤º
- ç®€å•æ˜“ç”¨

**æ‰©å±•å»ºè®®**ï¼š
- æ·»åŠ æœåŠ¡å™¨åˆ—è¡¨ç®¡ç†
- æ”¯æŒé…ç½®ä¿å­˜å’Œå¯¼å…¥
- æ·»åŠ æµé‡å›¾è¡¨
- æ”¯æŒæ·±è‰²æ¨¡å¼

## ğŸ”§ å…³é”®æŠ€æœ¯ç‚¹

### 1. ç½‘ç»œæ£€æµ‹

**é—®é¢˜**ï¼šå¦‚ä½•åˆ¤æ–­ç½‘ç»œæ˜¯å¦å¯ç”¨ï¼Ÿ

**æ–¹æ¡ˆ**ï¼š
```python
def test_internet_connection(self):
    # æ–¹æ³•1: pingæµ‹è¯•
    subprocess.run(['ping', '-c', '1', 'www.bing.com'])
    
    # æ–¹æ³•2: HTTPè¯·æ±‚
    requests.get('http://www.bing.com', timeout=5)
    
    # æ–¹æ³•3: æŸ¥è¯¢DNS
    socket.gethostbyname('www.bing.com')
```

### 2. å†…ç½‘IPè·å–

**é—®é¢˜**ï¼šå¦‚ä½•è·å–è®¾å¤‡çš„å†…ç½‘IPï¼Ÿ

**æ–¹æ¡ˆ**ï¼š
```python
# æ–¹æ³•1: ä»è®¤è¯é¡µé¢æå–
response = requests.get('http://10.252.252.5')
ip = re.search(r"v4ip='(\d+\.\d+\.\d+\.\d+)'", response.text)

# æ–¹æ³•2: ä½¿ç”¨netifacesåº“
import netifaces
netifaces.ifaddresses('eth0')[netifaces.AF_INET][0]['addr']

# æ–¹æ³•3: è¿æ¥å¤–éƒ¨åœ°å€
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.connect(("8.8.8.8", 80))
ip = s.getsockname()[0]
```

### 3. VPNå®ç°

**å½“å‰å®ç°**ï¼šç®€å•çš„TCPè½¬å‘

**æœªæ¥æ”¹è¿›**ï¼š

```python
# é€‰é¡¹1: SOCKS5ä»£ç†
import socks
# å®ç°å®Œæ•´çš„SOCKS5åè®®

# é€‰é¡¹2: HTTPä»£ç†
from http.server import HTTPServer
# å®ç°HTTP/HTTPSä»£ç†

# é€‰é¡¹3: TUN/TAPè™šæ‹Ÿç½‘å¡
import pytun
# åˆ›å»ºè™šæ‹Ÿç½‘å¡ï¼Œå®ç°çœŸæ­£çš„VPN

# é€‰é¡¹4: WireGuard
import wireguard
# ä½¿ç”¨ç°æœ‰VPNåè®®
```

### 4. å¹¶å‘å¤„ç†

**å½“å‰å®ç°**ï¼šå¤šçº¿ç¨‹

```python
# æ¯ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªçº¿ç¨‹
threading.Thread(target=self._handle_client, args=(socket, address))
```

**æ”¹è¿›æ–¹æ¡ˆ**ï¼š

```python
# é€‰é¡¹1: çº¿ç¨‹æ± 
from concurrent.futures import ThreadPoolExecutor
executor = ThreadPoolExecutor(max_workers=10)

# é€‰é¡¹2: å¼‚æ­¥IO
import asyncio
async def handle_client(reader, writer):
    # å¼‚æ­¥å¤„ç†

# é€‰é¡¹3: å¤šè¿›ç¨‹
from multiprocessing import Process
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

### å•å…ƒæµ‹è¯•

åˆ›å»º `tests/test_drcom_login.py`:

```python
import unittest
from drcom_login import DrcomLogin

class TestDrcomLogin(unittest.TestCase):
    def setUp(self):
        self.login = DrcomLogin('testuser', 'testpass')
    
    def test_get_local_ip(self):
        ip = self.login.get_local_ip()
        self.assertIsNotNone(ip)
        self.assertTrue(ip.startswith('172.'))
    
    def test_login(self):
        result = self.login.login()
        self.assertIn('success', result)

if __name__ == '__main__':
    unittest.main()
```

### é›†æˆæµ‹è¯•

```bash
# æµ‹è¯•æœåŠ¡ç«¯å¯åŠ¨
python vpn_server.py testuser testpass 9999

# æµ‹è¯•å®¢æˆ·ç«¯è¿æ¥
python vpn_client.py testuser testpass 127.0.0.1 9999
```

### æ€§èƒ½æµ‹è¯•

```python
import time
import statistics

# æµ‹è¯•ç™»å½•é€Ÿåº¦
times = []
for i in range(10):
    start = time.time()
    result = login.login()
    elapsed = time.time() - start
    times.append(elapsed)

print(f"å¹³å‡ç™»å½•æ—¶é—´: {statistics.mean(times):.2f}ç§’")
print(f"æœ€å¿«: {min(times):.2f}ç§’")
print(f"æœ€æ…¢: {max(times):.2f}ç§’")
```

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—

```python
# config.py
LOG_CONFIG = {
    'log_level': 'DEBUG',  # æ˜¾ç¤ºæ‰€æœ‰æ—¥å¿—
}
```

### 2. æŠ“åŒ…åˆ†æ

```bash
# æŠ“å–è®¤è¯æµé‡
tcpdump -i eth0 -w drcom.pcap host 10.252.252.5

# ä½¿ç”¨Wiresharkåˆ†æ
wireshark drcom.pcap
```

### 3. ä½¿ç”¨è°ƒè¯•å™¨

```python
# åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹
import pdb; pdb.set_trace()

# æˆ–ä½¿ç”¨IDEè°ƒè¯•å™¨
# VSCode: F5
# PyCharm: Shift+F9
```

### 4. æ¨¡æ‹Ÿç½‘ç»œç¯å¢ƒ

```bash
# æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
tc qdisc add dev eth0 root netem delay 100ms

# æ¨¡æ‹Ÿä¸¢åŒ…
tc qdisc add dev eth0 root netem loss 10%
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. å‡å°‘HTTPè¯·æ±‚

```python
# ä½¿ç”¨Sessionå¤ç”¨è¿æ¥
session = requests.Session()
session.get(url1)
session.get(url2)  # å¤ç”¨è¿æ¥
```

### 2. å¼‚æ­¥IO

```python
import asyncio

async def async_login():
    # å¼‚æ­¥ç™»å½•ï¼Œä¸é˜»å¡
    pass
```

### 3. ç¼“å­˜ä¼˜åŒ–

```python
from functools import lru_cache

@lru_cache(maxsize=128)
def get_config():
    # ç¼“å­˜é…ç½®ä¿¡æ¯
    pass
```

### 4. è¿æ¥æ± 

```python
from queue import Queue

connection_pool = Queue(maxsize=10)
# é¢„åˆ›å»ºè¿æ¥ï¼Œéœ€è¦æ—¶ä»æ± ä¸­è·å–
```

## ğŸ“ ä»£ç è§„èŒƒ

### Pythoné£æ ¼

éµå¾ª PEP 8 æ ‡å‡†ï¼š

```python
# å‘½åè§„èŒƒ
class MyClass:          # ç±»åï¼šå¤§é©¼å³°
    def my_method(self):  # æ–¹æ³•åï¼šå°å†™+ä¸‹åˆ’çº¿
        my_var = 1        # å˜é‡åï¼šå°å†™+ä¸‹åˆ’çº¿
        MY_CONST = 2      # å¸¸é‡ï¼šå¤§å†™+ä¸‹åˆ’çº¿

# å¯¼å…¥è§„èŒƒ
import os              # æ ‡å‡†åº“
import sys

import requests        # ç¬¬ä¸‰æ–¹åº“

from .config import *  # é¡¹ç›®å†…éƒ¨
```

### æ–‡æ¡£å­—ç¬¦ä¸²

```python
def my_function(param1, param2):
    """
    å‡½æ•°ç®€çŸ­æè¿°
    
    è¯¦ç»†æè¿°ï¼ˆå¯é€‰ï¼‰
    
    Args:
        param1 (str): å‚æ•°1è¯´æ˜
        param2 (int): å‚æ•°2è¯´æ˜
        
    Returns:
        bool: è¿”å›å€¼è¯´æ˜
        
    Raises:
        ValueError: å¼‚å¸¸è¯´æ˜
    """
    pass
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æäº¤ä»£ç 

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼š`git checkout -b feature/AmazingFeature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add some AmazingFeature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/AmazingFeature`
5. æäº¤ Pull Request

### æäº¤Issue

è¯·åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š
- é—®é¢˜æè¿°
- å¤ç°æ­¥éª¤
- é¢„æœŸè¡Œä¸º
- å®é™…è¡Œä¸º
- ç¯å¢ƒä¿¡æ¯ï¼ˆOSã€Pythonç‰ˆæœ¬ç­‰ï¼‰
- æ—¥å¿—æ–‡ä»¶

## ğŸ“š å‚è€ƒèµ„æ–™

- [Dr.COMåè®®åˆ†æ](https://github.com/drcoms/drcom-generic)
- [Pythonç½‘ç»œç¼–ç¨‹](https://docs.python.org/3/library/socket.html)
- [Fletæ–‡æ¡£](https://flet.dev/docs/)
- [SOCKS5åè®®](https://www.rfc-editor.org/rfc/rfc1928)

---

**æœ‰é—®é¢˜ï¼Ÿ** æ¬¢è¿æäº¤Issueæˆ–Pull Requestï¼

